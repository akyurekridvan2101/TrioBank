# Client Service - Production Environment
# Vault kullanır (EC2'de çalışan Vault)

replicaCount: 1  # Production için daha fazla replica

image:
  tag: "latest"
  pullPolicy: Always  # Dev ile aynı - image değişikliklerinde güncel versiyonu çek

app:
  environment: production
  logLevel: info  # Production'da debug yerine info
  logFormat: json  # Production'da structured logging

resources:
  requests:
    memory: 512Mi    # Production için artırıldı
    cpu: 200m       # Production için artırıldı
  limits:
    memory: 1Gi     # Production için artırıldı
    cpu: 500m      # Production için artırıldı

# Production environment config
config:
  APP_ENV: "production"
  CLIENT_SERVICE_PORT: ":8082"
  SQL_ADDRESS: "client-mssql.triobank.svc.cluster.local:1433"
  SQL_DATABASE_NAME: "client_db"
  KAFKA_BROKER: "kafka-kafka-bootstrap.triobank.svc.cluster.local:9092"
  KAFKA_TOPIC: "UserCreated"
  KAFKA_GROUP_ID: "client-service-consumer"
  ACCOUNT_SERVICE_BASE_URL: "http://account-service.triobank.svc.cluster.local:8081"

# Database Configuration - EC2 Private IP
# IP adresi Vault'ta secret/prod/services/client -> db_address olarak saklanıyor
# Terraform output: terraform output ec2_private_ip
databases:
  mssql:
    enabled: true
    serviceName: client-mssql
    type: mssql
    portName: mssql
    externalName: "10.0.0.182"  # EC2 Private IP (Vault'ta: db_address)
    annotations:
      description: "Client Service MSSQL database (Production - EC2)"

database:
  name: client_db
  port: 1433
  serviceName: client-mssql

# Vault Secrets Configuration
externalSecrets:
  # Database Credentials (Client Service'e özel)
  - name: db-credentials
    enabled: true
    vaultPath: secret/prod/services/client  # Production path
    targetSecret: client-db-credentials
    refreshInterval: "1h"
    fields:
      - secretKey: SQL_USERNAME
        property: db_username  # Vault'ta: db_username
      - secretKey: SQL_PASSWORD
        property: db_password   # Vault'ta: db_password

# Ingress Configuration for Production
ingress:
  enabled: true
  className: alb  # AWS ALB
  annotations:
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'
    alb.ingress.kubernetes.io/ssl-redirect: "443"
  hosts:
    - host: ""  # Vault'tan infrastructure/domain/api alınacak (sonra güncellenecek)
      paths:
        - path: /clients(/|$)(.*)
          pathType: ImplementationSpecific

